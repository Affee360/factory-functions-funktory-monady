import {
  CodeSurfer,
  CodeSurferColumns,
  Step,
} from "code-surfer";
import {
  github,
  vsDark,
  nightOwl,
} from "@code-surfer/themes";
import { Image, Head } from "mdx-deck";

export const theme = nightOwl;

<Head>
  <title>Factory Functions, functor, monad</title>
  <link rel="icon" type="image/x-icon" href="http://localhost:8081/favicon.ico" />
</Head>

# Cze 

<p style="text-align: center">
  Programowanie funkcyjne w JavaScript, czyli czym s
  Factory Functions, funktory i monady.
</p>

---

<CodeSurferColumns theme={theme}>

<Step>

```js showNumbers
class PieceOfCake {
  bake() {}
  decorate() {}
  cut() {}
}
```

</Step>

<Step>

```js showNumbers
class PieceOfCake {
  bake() {}
  decorate() {}
  cut() {}
}

class Muffin {
  bake() {}
  decorate() {}
  heatUp() {}
}
```

</Step>

<Step>

```js title="Przydao by si u偶y zasady Don't Repeat Yourself" showNumbers 1:11
class PieceOfCake {
  bake() {}
  decorate() {}
  cut() {}
}

class Muffin {
  bake() {}
  decorate() {}
  heatUp() {}
}
```

</Step>

<Step>

```js showNumbers 1:4
class Baking {
  bake() {}
  decorate() {}
}
```

</Step>

<Step>

```js title="inheritance" showNumbers
class Baking {
  bake() {}
  decorate() {}
}

class PieceOfCake extends Baking {
  cut() {}
}

class Muffin extends Baking {
  heatUp() {}
}
```

</Step>

<Step>

```js showNumbers
class Baking {
  bake() {}
  decorate() {}
}

class PieceOfCake extends Baking {
  cut() {}
}

class Muffin extends Baking {
  heatUp() {}
}

class Salad {
  mixed() {}
  decorate() {}
}
```

</Step>

<Step>

```js title="The Duplication by Necessity Problem" showNumbers 1:17
class Baking {
  bake() {}
  decorate() {}
}

class PieceOfCake extends Baking {
  cut() {}
}

class Muffin extends Baking {
  heatUp() {}
}

class Salad {
  mixed() {}
  decorate() {}
}
```

</Step>

</CodeSurferColumns>

---

# Factory Function

<p style="text-align: center">Factory function to dowolna funkcja, kt贸ra nie jest klas ani konstruktorem, kt贸ra zwraca (prawdopodobnie nowy) obiekt</p>

---

<CodeSurferColumns theme={theme}>

<Step>

```js title="Composition" showNumbers
const bakable = (state) => ({
  bake: () => console.log(`baking new ${state.type}`),
});

const decorable = (state) => ({
  decorate: () => console.log(`decorating new ${state.name}`),
});

const cutable = (state) => ({
  cut: () => console.log(`cuting new ${state.name}`),
});
```

</Step>

<Step>

```js title="Factory Function" showNumbers
const bakable = (state) => ({
  bake: () => console.log(`baking new ${state.type}`),
});

const decorable = (state) => ({
  decorate: () => console.log(`decorating new ${state.name}`),
});

const cutable = (state) => ({
  cut: () => console.log(`cuting new ${state.name}`),
});

const pieceOfCake = (name, type) => {
  const state = { name, type };

  return Object.assign({}, bakable(state), decorable(state), cutable(state));
};
```

</Step>

<Step>

```js title="Factory Function" showNumbers
const bakable = (state) => ({
  bake: () => console.log(`baking new ${state.type}`),
});

const decorable = (state) => ({
  decorate: () => console.log(`decorating new ${state.name}`),
});

const cutable = (state) => ({
  cut: () => console.log(`cuting new ${state.name}`),
});

const pieceOfCake = (name, type) => {
  const state = { name, type };

  return Object.assign({}, bakable(state), decorable(state), cutable(state));
};

const newPiece = pieceOfCake('chocolate cake' 'cake');
newPiece.bake();
newPiece.decorate();
newPiece.cut();
```

</Step>

</CodeSurferColumns>

---

<Image
  src="http://localhost:8081/1.png"
  style="background-image: contain; background-size: 400px auto;"
/>

---

<CodeSurferColumns theme={theme}>

<Step>

```js showNumbers
class List {
  items = []
}
```

</Step>

<Step>

```js showNumbers
class List {
  items = []

  addItem(item) {
    this.items.push(item)
  }
}
```

</Step>

<Step>

```js showNumbers
class List {
  items = []

  addItem(item) {
    this.items.push(item)
  }

  getItems() {
    return this.items;
  }
}
```

</Step>

<Step>

```js showNumbers
class List {
  items = []

  addItem(item) {
    this.items.push(item)
  }

  getItems() {
    return this.items;
  }
}

const numbers = new List()
```

</Step>

<Step>

```js showNumbers
class List {
  items = []

  addItem(item) {
    this.items.push(item)
  }

  getItems() {
    return this.items;
  }
}

const numbers = new List()
numbers.addItem(1);
numbers.addItem(2);
numbers.getItems();
```

</Step>

<Step>

```js showNumbers
class List {
  items = []

  addItem(item) {
    this.items.push(item)
  }

  getItems() {
    return this.items;
  }
}

const numbers = new List()
numbers.addItem(1);
numbers.addItem(2);
numbers.getItems();
numbers.items;
```

</Step>

<Step>

```js showNumbers
class List {
  items = []

  addItem(item) {
    this.items.push(item)
  }

  getItems() {
    return this.items;
  }
}

const numbers = new List()
numbers.addItem(1);
numbers.addItem(2);
numbers.getItems();
numbers.items;

const button = document.querySelector('button');
button.addEventListener('click', numbers.getItems) // undefined
button.addEventListener('click', numbers.getItems.bind(this)) // [1,2]
```

</Step>

</CodeSurferColumns>

---

# Wady

* Brak mo偶liwoci enkapsulacji
* Problematyczne sowo kluczowe this

---

<CodeSurferColumns theme={theme}>

<Step>

```js showNumbers
const list = () => {
  const items = [];
}
```

</Step>

<Step>

```js showNumbers
const list = () => {
  const items = [];

  return { 
    addItem: (item) => items.push(item),
    getItems: () => items,
  }
}
```

</Step>

<Step>

```js showNumbers
const list = () => {
  const items = [];

  return { 
    addItem: (item) => items.push(item),
    getItems: () => items,
  }
}

const numbers = list();
numbers.addItem(1);
numbers.addItem(2);
numbers.getItems(); // [1,2]
number.items; // undefined
```

</Step>

<Step>

```js showNumbers
const list = () => {
  const items = [];

  return { 
    addItem: (item) => items.push(item),
    getItems: () => items,
  }
}

const numbers = list();
numbers.addItem(1);
numbers.addItem(2);
numbers.getItems(); // [1,2]
number.items; // undefined
numbers.addItem = '';
numbers.addItem(3) // numbers.addItem is not a function
```

</Step>

<Step>

```js showNumbers
const list = () => {
  const items = [];

  return Object.freeze({ 
    addItem: (item) => items.push(item),
    getItems: () => items,
  })
}

const numbers = list();
numbers.addItem(1);
numbers.addItem(2);
numbers.getItems(); // [1,2]
numbers.items; // undefined
numbers.addItem = '';
numbers.addItem(3)
numbers.getItems() // [1,2,3]
```

</Step>

</CodeSurferColumns>

---

# Czym jest map ?

<p style="text-align: center">W wielu jzykach programowania map jest nazw funkcji wy偶szego rzdu, kt贸ra stosuje dan funkcj do ka偶dego elementu funktora</p>

* 5 -> 10
* [10] -> [20]
* {a: 20} -> {a: 40}

---


# Czym jest flatMap ?

<p style="text-align: center">Jest tym samym co map, z dodatkow mo偶liwoci spaszczania</p>

* [[5], [5]] -> [10, 10]
* {a: {b: 5} -> {'a.b': 5}


---

# Object in context

* Array(a)
* Observable(b)
* Promise(c)

--- 

# Funktory

<p style="text-align: center">
  Struktura danych, na kt贸rej mo偶esz mapowa funkcje w celu pobrania wartoci z kontenera, ich modyfikacji, a nastpnie wo偶enia z powrotem do kontenera.
</p>

---

<CodeSurferColumns theme={theme}>

<Step>

  ```js title="functor" showNumbers
  const array = [1,2,3,4];
  ```

</Step>

<Step>

  ```js title="functor" showNumbers
  const array = [1,2,3,4];
  const addOne = (value) => value + 1;
  ```

</Step>

<Step>

  ```js title="functor" showNumbers
  const array = [1,2,3,4];
  const addOne = (value) => value + 1;
  const arrayMap = array.map(addOne);
  ```

</Step>

</CodeSurferColumns>

---

# #1 Indentity

---

<CodeSurfer theme={theme}>

```js showNumbers
  const sameArray = array.map((v) => v);
  ```

</CodeSurfer>

---

# #2 Composition

---

<CodeSurferColumns theme={theme}>

<Step>

```js showNumbers
  const double = (value) => value * 2;
  const triple = (value) => value * 3;
  ```

</Step>

<Step>

 ```js showNumbers
  const double = (value) => value * 2;
  const triple = (value) => value * 3;

  const composition = array.map((v) => triple(double(v)));
  ```

</Step>

<Step>

 ```js showNumbers
  const double = (value) => value * 2;
  const triple = (value) => value * 3;

  const composition = array.map((v) => triple(double(v)));
  const chaining = array.map((v) => double(v)).map((v) => triple(v));
  ```

</Step>

</CodeSurferColumns>

---

<Image
  src="http://localhost:8081/2.png"
  style="background-image: contain; background-size: 400px auto;"
/>

---

# Jak stworzy functor

---

<CodeSurferColumns theme={theme}>

<Step>

```js showNumbers
  const double = (value) => value * 2;
  const triple = (value) => value * 3;
  ```

</Step>

<Step>

```js showNumbers
  const double = (value) => value * 2;
  const triple = (value) => value * 3;

  const functor = (v) => ({})
  ```

</Step>

<Step>

```js showNumbers
  const double = (value) => value * 2;
  const triple = (value) => value * 3;

  const functor = (v) => ({
    map: (fn) => functor(fn(v)),
  })
  ```

</Step>

<Step>

```js showNumbers
  const double = (value) => value * 2;
  const triple = (value) => value * 3;

  const functor = (v) => ({
    map: (fn) => functor(fn(v)),
    valueOf: () => v,
  })
  ```

</Step>

<Step>

```js showNumbers
  const double = (value) => value * 2;
  const triple = (value) => value * 3;

  const functor = (v) => ({
    map: (fn) => functor(fn(v)),
    valueOf: () => v,
  })

  const number = functor(2);
  ```

</Step>

<Step>

```js showNumbers
  const double = (value) => value * 2;
  const triple = (value) => value * 3;

  const functor = (v) => ({
    map: (fn) => functor(fn(v)),
    valueOf: () => v,
  })

  const number = functor(2);
  console.log("functor", number.map(double).map(triple).valueOf());
  ```

</Step>

</CodeSurferColumns>

---

<Image
  src="http://localhost:8081/3.png"
  style="background-image: contain; background-size: 400px auto;"
/>

---

# Monada

<p style="text-align: center">
  Spos贸b komponowania funkcji, kt贸ry opr贸cz wartoci zwracanej wymagaj kontekstu
</p>

---

<CodeSurferColumns theme={theme}>

<Step>

```js showNumbers 
  const functor = (v) => ({
    map: (fn) => functor(fn(v)),
    valueOf: () => v,
    inspect: () => `functor(${v})`,
  });
  ```

</Step>

<Step>

```js showNumbers 
  const functor = (v) => ({
    map: (fn) => functor(fn(v)),
    valueOf: () => v,
    inspect: () => `functor(${v})`,
  });

  functor(5).map(double);
  ```

</Step>

<Step>

```js showNumbers 
  const functor = (v) => ({
    map: (fn) => functor(fn(v)),
    valueOf: () => v,
    inspect: () => `functor(${v})`,
  });

  functor(5).map(double);
  // functor(5) -> functor(10)
  ```

</Step>

</CodeSurferColumns>

--- 

<CodeSurferColumns theme={theme}>

<Step>

```js title="Przykady monad" showNumbers 
  [1, 2, 3, 4].flatMap((v) => [v * 2])
  ```

</Step>

<Step>

```js title="Przykady monad" showNumbers 
  [1, 2, 3, 4].flatMap((v) => [v * 2])

  const promise = new Promise((res) => setTimeout(() => res("done"), 500));
  ```

</Step>

<Step>

```js title="Przykady monad" showNumbers 
  [1, 2, 3, 4].flatMap((v) => [v * 2])

  const promise = new Promise((res) => setTimeout(() => res("done"), 500));
  promise.then((data) => console.log(data));
  ```

</Step>

</CodeSurferColumns>

---

<h1 style="text-align: center">Jak w rzeczywistoci dziaa promise</h1>

<CodeSurfer>

```js showNumbers
const promise = new Promise((res) => setTimeout(() => res("done"), 500));
promise.then((data) => console.log(data))
```

</CodeSurfer>

<p style="text-align: center">Promise(Promise('done')) w calbacku tych funkcji mamy dostp do wartoci</p>

---

<CodeSurfer>

```js showNumbers
const promise2 = promise.then((data) => data).then((data) => console.log(data));
console.log("this is promise", Object.prototype.toString.call(promise2));
```

</CodeSurfer>

<Image
  src="http://localhost:8081/4.png"
  style="background-image: contain; background-size: 400px auto;"
/>

<p style="text-align: center">Promise(Promise('done')) -> Promise('done') = flat map</p>

---

# Przykad wasnego monada

<p style="text-align: center">Funkcja do przeliczania stopni fahrenheita na celsjusza</p>

---

<CodeSurferColumns theme={theme}>

<Step>

```js showNumbers
const fahrenheitToCelcius = (a) => (a - 32) * 0.5556;
```

</Step>

<Step>

```js showNumbers
const fahrenheitToCelcius = (a) => (a - 32) * 0.5556;

const value1 = 15;
const value2 = null;
```

</Step>

<Step>

```js showNumbers
const fahrenheitToCelcius = (a) => (a - 32) * 0.5556;

const value1 = 15;
const value2 = null;

console.log("good", fahrenheitToCelcius(value1));
console.log("bad", fahrenheitToCelcius(value2));
```

</Step>

</CodeSurferColumns>

---

# Powstaje pewnien problem

<Image
  src="http://localhost:8081/5.png"
  style="background-image: contain; background-size: 400px auto;"
/>

<p style="text-align: center">Wszystko dlatego 偶e null jest zamieniany na 0</p>
<p style="text-align: center">Potrzebujemy czego co zatrzyma kompozycje jeli warto jest nullem</p>

---

<CodeSurferColumns theme={theme}>

<Step>

```js showNumbers
const just = (v) => ({
  map: (fn) => just(fn(v)),
  flatMap: (fn) => fn(x),
  valueOf: () => v,
  inspect: () => `just(${v})`,
  type: "just",
});
```

</Step>

<Step>

```js showNumbers
const just = (v) => ({
  map: (fn) => just(fn(v)),
  flatMap: (fn) => fn(x),
  valueOf: () => v,
  inspect: () => `just(${v})`,
  type: "just",
});

const nothing = () => ({
  map: (fn) => nothing(fn()),
  flatMap: (fn) => fn(),
  valueOf: () => nothing(),
  inspect: () => `nothing()`,
  type: "nothing",
});
```

</Step>

<Step>

```js showNumbers
const just = (v) => ({
  map: (fn) => just(fn(v)),
  flatMap: (fn) => fn(x),
  valueOf: () => v,
  inspect: () => `just(${v})`,
  type: "just",
});

const nothing = () => ({
  map: (fn) => nothing(fn()),
  flatMap: (fn) => fn(),
  valueOf: () => nothing(),
  inspect: () => `nothing()`,
  type: "nothing",
});

const maybeOf = (x) => (!x || x.type === "nothing" ? nothing() : just(x));
```

</Step>

<Step>

```js showNumbers
const just = (v) => ({
  map: (fn) => just(fn(v)),
  flatMap: (fn) => fn(x),
  valueOf: () => v,
  inspect: () => `just(${v})`,
  type: "just",
});

const nothing = () => ({
  map: (fn) => nothing(fn()),
  flatMap: (fn) => fn(),
  valueOf: () => nothing(),
  inspect: () => `nothing()`,
  type: "nothing",
});

const maybeOf = (x) => (!x || x.type === "nothing" ? nothing() : just(x));

const maybe = {
  of: maybeOf,
};
```

</Step>

<Step>

```js showNumbers
const just = (v) => ({
  map: (fn) => just(fn(v)),
  flatMap: (fn) => fn(x),
  valueOf: () => v,
  inspect: () => `just(${v})`,
  type: "just",
});

const nothing = () => ({
  map: (fn) => nothing(fn()),
  flatMap: (fn) => fn(),
  valueOf: () => nothing(),
  inspect: () => `nothing()`,
  type: "nothing",
});

const maybeOf = (x) => (!x || x.type === "nothing" ? nothing() : just(x));

const maybe = {
  of: maybeOf,
};

const temp1 = maybe.of(value1).map(fahrenheitToCelcius).inspect();
const temp2 = maybe.of(value2).map(fahrenheitToCelcius).map(double).inspect();
console.log(temp1);
console.log(temp2);
```

</Step>

</CodeSurferColumns>

---

# Teraz oba wyniki s poprawne

<Image
  src="http://localhost:8081/6.png"
  style="background-image: contain; background-size: 400px auto;"
/>

---

# Pytania ? 